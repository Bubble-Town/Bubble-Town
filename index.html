<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Town - Virtual Eco Town</title>
    <link rel="stylesheet" href="css/xp-ui.css">
    <link rel="stylesheet" href="css/frutiger-aero.css">
    <link rel="stylesheet" href="css/avatars.css">
    <link rel="stylesheet" href="css/aquarium.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/social.css">
</head>
<body>
    <!-- Auth Modal -->
    <div id="authModal" class="xp-window modal-center">
        <div class="xp-title-bar">
            <span class="xp-icon">üîê</span>
            <span class="xp-title">Welcome to Bubble Town</span>
            <div class="xp-buttons">
                <button class="xp-minimize">_</button>
                <button class="xp-maximize">‚ñ°</button>
                <button class="xp-close">√ó</button>
            </div>
        </div>
        <div class="xp-content">
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Sign In</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>
            
            <div id="loginForm" class="auth-form">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" class="xp-input" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="loginPassword" class="xp-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button id="loginBtn" class="xp-button-primary" onclick="signInWithEmail()">Sign In</button>
                <div class="divider">or</div>
                <button id="googleSignIn" class="xp-button-google" onclick="signInWithGoogle()">
                    <img src="https://www.google.com/favicon.ico" alt="Google">
                    Sign in with Google
                </button>
            </div>
            
            <div id="registerForm" class="auth-form hidden">
                <div class="form-group">
                    <label>Display Name:</label>
                    <input type="text" id="registerName" class="xp-input" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="registerEmail" class="xp-input" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="registerPassword" class="xp-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>Date of Birth:</label>
                    <input type="date" id="registerBirthDate" class="xp-input" required>
                </div>
                <div class="form-group age-verification">
                    <label class="checkbox-label">
                        <input type="checkbox" id="ageConfirm" required>
                        <span>I confirm I am 13 years or older</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>Choose Your Color:</label>
                    <div class="color-picker">
                        <div class="color-option" data-color="aqua" style="background: #00CED1;"></div>
                        <div class="color-option" data-color="sky" style="background: #87CEEB;"></div>
                        <div class="color-option" data-color="mint" style="background: #98FF98;"></div>
                        <div class="color-option" data-color="lemon" style="background: #FFFACD;"></div>
                        <div class="color-option" data-color="pink" style="background: #FFB6C1;"></div>
                        <div class="color-option" data-color="lavender" style="background: #E6E6FA;"></div>
                    </div>
                </div>
                <button id="registerBtn" class="xp-button-primary" onclick="registerWithEmail()">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Main Game Interface -->
    <div id="gameInterface" class="hidden">
        <!-- Top Bar -->
        <div class="xp-taskbar">
            <div class="xp-start-btn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Windows_logo_-_2012.svg/1024px-Windows_logo_-_2012.svg.png" alt="Start">
                <span>Start</span>
            </div>
            <div class="xp-taskbar-items">
                <div class="taskbar-item active" data-window="world">
                    <span>ü´ß</span> Bubble Town
                </div>
                <div class="taskbar-item" data-window="aquarium">
                    <span>üê†</span> Aquarium
                </div>
                <div class="taskbar-item" data-window="customize">
                    <span>üë§</span> My Avatar
                </div>
            </div>
            <div class="xp-clock" id="clock">12:00 PM</div>
        </div>

        <!-- Main World Window -->
        <div id="worldWindow" class="xp-window game-window">
            <div class="xp-title-bar">
                <span class="xp-icon">üåç</span>
                <span class="xp-title">Frutiger Eco Town</span>
                <div class="xp-buttons">
                    <button class="xp-minimize">_</button>
                    <button class="xp-maximize">‚ñ°</button>
                    <button class="xp-close">√ó</button>
                </div>
            </div>
            <div class="xp-content world-container">
                <!-- Isometric World -->
                <div id="isometricWorld" class="isometric-world">
                    <!-- Grid tiles -->
                    <div class="world-grid">
                        <!-- Generated by JS -->
                    </div>
                    
                    <!-- Buildings and Objects -->
                    <div class="world-objects">
                        <!-- Eco House -->
                        <div class="building eco-house" style="grid-column: 3; grid-row: 3;">
                            <div class="building-3d">
                                <div class="roof"></div>
                                <div class="walls">
                                    <div class="solar-panel"></div>
                                    <div class="window"></div>
                                </div>
                                <div class="shadow"></div>
                            </div>
                        </div>
                        
                        <!-- Wind Turbine -->
                        <div class="building wind-turbine" style="grid-column: 6; grid-row: 2;">
                            <div class="turbine-base"></div>
                            <div class="turbine-blades">
                                <div class="blade"></div>
                                <div class="blade"></div>
                                <div class="blade"></div>
                            </div>
                        </div>
                        
                        <!-- Tree -->
                        <div class="nature tree" style="grid-column: 2; grid-row: 5;">
                            <div class="trunk"></div>
                            <div class="leaves"></div>
                        </div>
                        
                        <!-- Tree 2 -->
                        <div class="nature tree" style="grid-column: 7; grid-row: 6;">
                            <div class="trunk"></div>
                            <div class="leaves"></div>
                        </div>
                        
                        <!-- Water Feature -->
                        <div class="nature pond" style="grid-column: 4; grid-row: 5;">
                            <div class="water"></div>
                            <div class="water-ripple"></div>
                            <div class="water-ripple delay-1"></div>
                            <div class="water-ripple delay-2"></div>
                        </div>
                        
                        <!-- AQUARIUM - Clickable -->
                        <div id="aquariumBuilding" class="building aquarium-building" style="grid-column: 5; grid-row: 4;">
                            <div class="aquarium-3d">
                                <div class="tank-glass">
                                    <div class="tank-water"></div>
                                    <div class="tank-bubbles">
                                        <div class="bubble"></div>
                                        <div class="bubble delay-1"></div>
                                        <div class="bubble delay-2"></div>
                                        <div class="bubble delay-3"></div>
                                    </div>
                                    <div class="fish-tank">
                                        <div class="tank-fish"></div>
                                    </div>
                                </div>
                                <div class="tank-base"></div>
                                <div class="click-hint">üñ±Ô∏è Click to enter!</div>
                            </div>
                        </div>
                        
                        <!-- Flowers -->
                        <div class="nature flower" style="grid-column: 1; grid-row: 3;">
                            <div class="stem"></div>
                            <div class="petals"></div>
                        </div>
                        <div class="nature flower" style="grid-column: 8; grid-row: 3;">
                            <div class="stem"></div>
                            <div class="petals pink"></div>
                        </div>
                        
                        <!-- Clouds -->
                        <div class="cloud" style="top: 10%; left: 20%;">
                            <div class="cloud-puff"></div>
                            <div class="cloud-puff"></div>
                            <div class="cloud-puff"></div>
                        </div>
                        <div class="cloud" style="top: 15%; left: 60%; animation-delay: -10s;">
                            <div class="cloud-puff"></div>
                            <div class="cloud-puff"></div>
                        </div>
                    </div>
                    
                    <!-- Avatars Container -->
                    <div id="avatarsContainer" class="avatars-container"></div>
                    
                    <!-- Speech Bubbles Container -->
                    <div id="speechBubbles" class="speech-bubbles-container"></div>
                </div>
                
                <!-- Frutiger Aero Effects -->
                <div class="aero-effects">
                    <div class="ambient-glow"></div>
                    <div class="shimmer-overlay"></div>
                    <div class="floating-bubbles">
                        <div class="aero-bubble"></div>
                        <div class="aero-bubble"></div>
                        <div class="aero-bubble"></div>
                        <div class="aero-bubble"></div>
                        <div class="aero-bubble"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat History Box -->
        <div id="chatWindow" class="xp-window chat-window minimized">
            <div class="xp-title-bar chat-header">
                <span class="xp-icon">üí¨</span>
                <span class="xp-title">Chat History</span>
                <div class="xp-buttons">
                    <button class="xp-minimize" id="chatMinimize">_</button>
                    <button class="xp-maximize">‚ñ°</button>
                </div>
            </div>
            <div class="xp-content chat-content">
                <div id="chatHistory" class="chat-history"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" class="xp-input chat-input" placeholder="Type a message..." maxlength="100">
                    <button id="sendChat" class="xp-button-small">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Aquarium Fullscreen Modal -->
    <div id="aquariumModal" class="fullscreen-modal hidden">
        <div class="aquarium-room">
            <div class="aquarium-header">
                <h2>üê† Bubble Aquarium</h2>
                <button id="closeAquarium" class="xp-button-close">‚úï Close</button>
            </div>
            
            <div class="aquarium-tank">
                <div class="tank-background">
                    <div class="coral coral-1"></div>
                    <div class="coral coral-2"></div>
                    <div class="seaweed">
                        <div class="weed"></div>
                        <div class="weed"></div>
                        <div class="weed"></div>
                    </div>
                    <div class="sand"></div>
                </div>
                
                <!-- Animated Fish -->
                <div id="aquariumFish" class="fish-container">
                    <!-- Clownfish -->
                    <div class="clownfish" id="clownfish1">
                        <div class="fish-body">
                            <div class="stripe"></div>
                            <div class="stripe"></div>
                            <div class="fin"></div>
                            <div class="tail"></div>
                            <div class="eye"></div>
                        </div>
                    </div>
                    <div class="clownfish" id="clownfish2" style="animation-delay: -2s;">
                        <div class="fish-body">
                            <div class="stripe"></div>
                            <div class="stripe"></div>
                            <div class="fin"></div>
                            <div class="tail"></div>
                            <div class="eye"></div>
                        </div>
                    </div>
                    <div class="clownfish" id="clownfish3" style="animation-delay: -5s;">
                        <div class="fish-body">
                            <div class="stripe"></div>
                            <div class="stripe"></div>
                            <div class="fin"></div>
                            <div class="tail"></div>
                            <div class="eye"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Dolphin (hidden until unlocked) -->
                <div id="dolphinContainer" class="dolphin-container hidden">
                    <div class="dolphin">
                        <div class="dolphin-body"></div>
                        <div class="dolphin-fin"></div>
                        <div class="dolphin-tail"></div>
                    </div>
                </div>
                
                <!-- Bubbles -->
                <div class="aquarium-bubbles">
                    <div class="aq-bubble"></div>
                    <div class="aq-bubble"></div>
                    <div class="aq-bubble"></div>
                    <div class="aq-bubble"></div>
                    <div class="aq-bubble"></div>
                    <div class="aq-bubble"></div>
                </div>
                
                <!-- Light rays -->
                <div class="light-rays">
                    <div class="ray"></div>
                    <div class="ray"></div>
                    <div class="ray"></div>
                </div>
            </div>
            
            <div class="aquarium-info">
                <div class="time-tracker">
                    <h3>‚è±Ô∏è Time Spent: <span id="aquariumTime">0:00</span></h3>
                    <div class="unlock-progress">
                        <div class="progress-item" id="clownfishUnlock">
                            <span class="reward-icon">üê†</span>
                            <span class="reward-text">Clownfish Pet (1 hour)</span>
                            <span class="reward-status locked">üîí</span>
                        </div>
                        <div class="progress-item" id="dolphinUnlock">
                            <span class="reward-icon">üê¨</span>
                            <span class="reward-text">Dolphin Pet (6 hours)</span>
                            <span class="reward-status locked">üîí</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Avatar Customization Modal -->
    <div id="customizeModal" class="xp-window modal-center hidden">
        <div class="xp-title-bar">
            <span class="xp-icon">üë§</span>
            <span class="xp-title">Customize Avatar</span>
            <div class="xp-buttons">
                <button class="xp-close" id="closeCustomize">√ó</button>
            </div>
        </div>
        <div class="xp-content customize-content">
            <div class="customize-preview">
                <div id="previewAvatar" class="msn-avatar large"></div>
            </div>
            
            <div class="customize-options">
                <h3>Choose Color:</h3>
                <div class="color-picker large">
                    <div class="color-option" data-color="aqua" style="background: #00CED1;"></div>
                    <div class="color-option" data-color="sky" style="background: #87CEEB;"></div>
                    <div class="color-option" data-color="mint" style="background: #98FF98;"></div>
                    <div class="color-option" data-color="lemon" style="background: #FFFACD;"></div>
                    <div class="color-option" data-color="pink" style="background: #FFB6C1;"></div>
                    <div class="color-option" data-color="lavender" style="background: #E6E6FA;"></div>
                </div>
                
                <h3>Your Pets:</h3>
                <div id="userPets" class="pets-inventory">
                    <p class="no-pets">Visit the aquarium to unlock pets!</p>
                </div>
                
                <h3>Equip Pet:</h3>
                <div id="equipPet" class="equip-section">
                    <select id="petSelect" class="xp-input">
                        <option value="">No pet</option>
                    </select>
                </div>
            </div>
            
            <button id="saveCustomize" class="xp-button-primary">Save Changes</button>
        </div>
    </div>

    <!-- User Info Bar -->
    <div id="userBar" class="user-bar hidden">
        <div class="user-info">
            <div id="userAvatarSmall" class="msn-avatar small"></div>
            <span id="userName">User</span>
        </div>
        <button id="logoutBtn" class="xp-button-small">Logout</button>
    </div>

    <!-- Admin Panel (Admin only) -->
    <div id="adminPanel" class="xp-window admin-panel hidden">
        <div class="xp-title-bar">
            <span class="xp-icon">üõ°Ô∏è</span>
            <span class="xp-title">Admin Panel</span>
            <div class="xp-buttons">
                <button class="xp-minimize" id="adminMinimize">_</button>
                <button class="xp-close" id="adminClose">√ó</button>
            </div>
        </div>
        <div class="xp-content admin-content">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="reports">Reports</button>
                <button class="admin-tab" data-tab="users">Users</button>
            </div>
            
            <div id="reportsTab" class="admin-tab-content">
                <h3>Pending Reports</h3>
                <div id="reportsList" class="reports-list">
                    <p class="no-reports">No pending reports</p>
                </div>
            </div>
            
            <div id="usersTab" class="admin-tab-content hidden">
                <h3>User Management</h3>
                <div class="block-user-form">
                    <input type="text" id="blockUserId" class="xp-input" placeholder="User ID to block">
                    <input type="text" id="blockReason" class="xp-input" placeholder="Reason for blocking">
                    <button id="blockUserBtn" class="xp-button-warning">Block User</button>
                </div>
                <div id="blockedUsersList" class="blocked-users-list">
                    <h4>Blocked Users</h4>
                    <p class="no-blocked">No blocked users</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Friends Panel -->
    <div id="friendsPanel" class="xp-window friends-panel hidden">
        <div class="xp-title-bar">
            <span class="xp-icon">üë•</span>
            <span class="xp-title">Friends</span>
            <div class="xp-buttons">
                <button class="xp-minimize" id="friendsMinimize">_</button>
                <button class="xp-close" id="friendsClose">√ó</button>
            </div>
        </div>
        <div class="xp-content friends-content">
            <div class="friends-tabs">
                <button class="friends-tab active" data-tab="friends">My Friends</button>
                <button class="friends-tab" data-tab="requests">Requests</button>
                <button class="friends-tab" data-tab="add">Add Friend</button>
            </div>
            
            <div id="friendsListTab" class="friends-tab-content">
                <div id="friendsList" class="friends-list">
                    <p class="no-friends">No friends yet. Send a friend request!</p>
                </div>
            </div>
            
            <div id="requestsTab" class="friends-tab-content hidden">
                <div id="friendRequestsList" class="requests-list">
                    <p class="no-requests">No pending requests</p>
                </div>
            </div>
            
            <div id="addFriendTab" class="friends-tab-content hidden">
                <div class="add-friend-form">
                    <input type="text" id="friendSearchInput" class="xp-input" placeholder="Enter username to add">
                    <button id="searchFriendBtn" class="xp-button-primary">Search</button>
                </div>
                <div id="searchResults" class="search-results"></div>
            </div>
        </div>
    </div>

    <!-- Private Messages Panel -->
    <div id="pmPanel" class="xp-window pm-panel hidden">
        <div class="xp-title-bar">
            <span class="xp-icon">üíå</span>
            <span class="xp-title">Private Messages</span>
            <div class="xp-buttons">
                <button class="xp-minimize" id="pmMinimize">_</button>
                <button class="xp-close" id="pmClose">√ó</button>
            </div>
        </div>
        <div class="xp-content pm-content">
            <div class="pm-layout">
                <div class="pm-conversations">
                    <h4>Conversations</h4>
                    <div id="pmConversationsList" class="conversations-list">
                        <p class="no-conversations">No conversations yet</p>
                    </div>
                </div>
                <div class="pm-chat-area">
                    <div id="pmChatHeader" class="pm-chat-header">
                        <span>Select a conversation</span>
                    </div>
                    <div id="pmMessages" class="pm-messages"></div>
                    <div class="pm-input-area">
                        <input type="text" id="pmInput" class="xp-input pm-input" placeholder="Type a private message..." maxlength="200">
                        <button id="sendPmBtn" class="xp-button-small">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emotes Menu -->
    <div id="emotesMenu" class="emotes-menu hidden">
        <div class="emotes-grid">
            <button class="emote-btn" data-emote="wave">üëã</button>
            <button class="emote-btn" data-emote="heart">‚ù§Ô∏è</button>
            <button class="emote-btn" data-emote="laugh">üòÑ</button>
            <button class="emote-btn" data-emote="sad">üò¢</button>
            <button class="emote-btn" data-emote="dance">üíÉ</button>
            <button class="emote-btn" data-emote="sleep">üò¥</button>
            <button class="emote-btn" data-emote="music">üéµ</button>
            <button class="emote-btn" data-emote="sparkle">‚ú®</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="ambientMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="bubbleSound">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
    </audio>

    <!-- Main App Module -->
    <script type="module" src="js/app.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Auth script -->
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyABei0Z3yZ3xV741mW3ekV2ibFEf9QlCjc",
            authDomain: "bubble-town-25f24.firebaseapp.com",
            databaseURL: "https://bubble-town-25f24-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "bubble-town-25f24",
            storageBucket: "bubble-town-25f24.firebasestorage.app",
            messagingSenderId: "885824915709",
            appId: "1:885824915709:web:fd25195326cfd31577d694"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // Google sign-in handler
        function signInWithGoogle() {
            console.log('Starting Google sign-in...');
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('Google sign-in successful:', result.user);
                })
                .catch((error) => {
                    console.error('Google sign-in error:', error);
                    alert('Sign-in error: ' + error.message);
                });
        }
        
        // Email login handler
        function signInWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch((error) => alert('Login error: ' + error.message));
        }
        
        // Register handler
        function registerWithEmail() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            auth.createUserWithEmailAndPassword(email, password)
                .catch((error) => alert('Registration error: ' + error.message));
        }
        
        // Auth state listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('authModal').style.display = 'none';
                document.getElementById('gameInterface').classList.remove('hidden');
            } else {
                document.getElementById('authModal').style.display = 'block';
                document.getElementById('gameInterface').classList.add('hidden');
            }
        });
    </script>
</body>
</html>